@using Microsoft.AspNetCore.Blazor.Services
@using blazor.jwttest.Shared
@page "/edit/todo/{todoId}"
@inject HttpClient Http
@inject IUriHelper UriHelper

<TodoForm ref="todoForm" LoadingMessage="Loading Todo, please wait..." TodoInfo="@loadedTodo" OnSaveClicked="@SaveClicked" OnCancelClicked="@CancelClicked"></TodoForm>

@functions {

  [Parameter]
  string TodoId { get; set; }

  private Todo loadedTodo;
  TodoForm todoForm;

  protected override async Task OnInitAsync()
  {
    Console.WriteLine($"Init, getting data");
    loadedTodo = await Http.GetJsonAsync<Todo>($"api/todos/retrieve/{TodoId}");
    Console.WriteLine($"Init got data");
  }

  private async void SaveClicked()
  {
    Console.WriteLine($"Save Clicked");
    await Http.SendJsonAsync<Todo>(HttpMethod.Post, "api/todos/update", todoForm.TodoData);
    UriHelper.NavigateTo("edit/todos");
  }

  private void CancelClicked()
  {
    Console.WriteLine($"Cancel Clicked");
    UriHelper.NavigateTo("/edit/todos");
  }

}

