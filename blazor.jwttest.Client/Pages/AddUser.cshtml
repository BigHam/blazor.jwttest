@using Microsoft.AspNetCore.Blazor.Services
@using blazor.jwttest.Shared
@page "/add/user"
@inject HttpClient Http
@inject IUriHelper UriHelper

<UserForm ref="userForm" LoadingMessage="Initialising User, please wait..." MakeIdReadOnly="false" UserInfo="@newUser" OnSaveClicked="@SaveClicked" OnCancelClicked="@CancelClicked"></UserForm>

@functions {

  [Parameter]
  string UserId { get; set; }

  private User newUser;
  UserForm userForm;

  protected override async Task OnInitAsync()
  {
    newUser = new User();
    newUser.Id = 0; // Set it to 0 so EF core creates a new one
  }

  private async void SaveClicked()
  {
    await Http.SendJsonAsync<User>(HttpMethod.Post, "api/users/create", userForm.UserData);
    UriHelper.NavigateTo("edit/users");
  }

  private void CancelClicked()
  {
    UriHelper.NavigateTo("/edit/users");
  }

}

